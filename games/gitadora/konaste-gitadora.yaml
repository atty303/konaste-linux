name: GITADORA
game_slug: konaste-gitadora
version: Installer
slug: konaste-gitadora-installer
runner: wine

script:
  game:
    exe: $GAMEDIR/drive_c/Games/GITADORA/launcher/modules/launcher.exe
    prefix: $GAMEDIR
    working_dir: $GAMEDIR/drive_c/Games/GITADORA
  files:
    - installer: "N/A:Select the game's setup file"
  installer:
    - task:
        description: Creating Wine prefix
        name: create_prefix
        prefix: $GAMEDIR
    - task:
        name: winetricks
        app: win10 ie8 fakejapanese_ipamona
    - task:
        name: wineexec
        executable: installer
    - write_file:
        file: $HOME/.local/bin/konaste-gitadora-launcher.sh
        content: |
          #!/bin/bash
          echo "RUN: $@"
          wrapper=$(mktemp --tmpdir konaste-gitadora.XXXX.sh)
          cleanup() {
            rm -f "$wrapper"
          }
          trap cleanup EXIT

          lutris -b "$wrapper" lutris:konaste-gitadora
          echo ' "$@"' >>"$wrapper"
          chmod +x "$wrapper"
          "$wrapper" "$@"
    - chmodx: $HOME/.local/bin/konaste-gitadora-launcher.sh
    - write_file:
        file: $HOME/.local/share/applications/konaste-gitadora.desktop
        content: |
          [Desktop Entry]
          Exec=konaste-gitadora-launcher.sh %u
          Type=Application
          Name=konaste-gitadora.desktop
          MimeType=x-scheme-handler/konaste.gitadora;
    - execute:
        command: update-desktop-database $HOME/.local/share/applications
    - execute:
        command: xdg-mime default konaste-giradora.desktop x-scheme-handler/konaste.gitadora
